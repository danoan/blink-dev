<!DOCUMENT html>
<html>
<head>
	<meta name="viewport" content="initial-scale=1.0, user-scalable=no">
	<link rel="stylesheet" href="static/css/normalize.css"></link>
	<link rel="stylesheet" href="static/css/bootstrap.css"></link>
	<link rel="stylesheet" href="static/css/mygs-fluid.css"></link>
	<link rel="stylesheet" href="static/css/base.css"></link>
	<link href="/maps/documentation/javascript/examples/default.css" rel="stylesheet">

	<script type="text/javascript" src="static/js/jquery-1.8.2.min.js"></script>
	<script type="text/javascript" src="static/js/bootstrap.js"></script>

	<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
	<script type="text/javascript" src="static/js/markerclusterer.js"></script>
</head>
<body>

	<div class="hero-unit">
		1746 MAPS
	</div>

    <script>
		var myMap;

		function generateMarkerDict()
		{

			var neighborhood = [ {b:"meier",c:[-22.899185,-43.282964],r:120},
								{b:"tijuca",c:[-22.934998,-43.237064],r:305},
								{b:"penha",c:[-22.834889,-43.277821],r:128},
								{b:"sao cristovao",c:[-22.896912,-43.220175],r:14},
								{b:"centro",c:[-22.907408,-43.177141],r:154},
								{b:"catete",c:[-22.925117,-43.179152],r:89},
								{b:"ipanema",c:[-22.982693,-43.204472],r:53},
								{b:"botafogo",c:[-22.951596,-43.189844],r:201},
								{b:"barra",c:[-22.993163,-43.365837],r:171}
							   ];

			var markerDict = {};

			for (var i = 0;i < neighborhood.length; i++){
				markerDict[neighborhood[i].b] = neighborhood[i].c;
			}

			return markerDict;
		}

		function initialize() 
		{
			var mapOptions = 
			{
		  		zoom: 12,
	    		center: new google.maps.LatLng(-22.934998,-43.237064),
	    		mapTypeId: google.maps.MapTypeId.ROADMAP
		  	};
		
		  	myMap = new google.maps.Map(document.getElementById('mapTeste'),
		      					mapOptions);

		  	setMarkers(generateMarkerDict());
		}

		function setMarkers(markerDict){

			var markers = [];

		  	for (key in markerDict){
		  		
				var latLng = new google.maps.LatLng(markerDict[key][0], markerDict[key][1]);
			  	var markerImg = new google.maps.MarkerImage('static/img/tree.png', new google.					maps.Size(24, 32));

			  	var marker = new google.maps.Marker({
			  			position: latLng, 
			  			map: myMap,
			  			icon:markerImg,
			  			callId: "31879314"
			  			});

			  	addMarkerClickListener(marker);

			  	markers.push(marker);
		  	}

			var markerCluster = new MarkerClusterer(myMap, markers);	
		}

		function addMarkerClickListener(marker) {
			google.maps.event.addListener(marker, 'click', function() {				
				location.assign("social_panel/" + marker.callId)
		  	});
		}

		google.maps.event.addDomListener(window, 'load', initialize);

		$(document).ready(function(){

			$(".call-card").click(function(e){
				// console.log($(e.currentTarget));
				var cid = $(e.currentTarget).attr("call_id");
				// console.log(cid);
				location.assign("social_panel/" + cid);
			});

		});


	</script>

	<div class="content">
			{% for ob in data %}

				{% if loop.index0%4==0 %}				
					<div class="row">
						<div id="call-list">		
				{% endif %}

				<div class="col3">
					<div call_id="{{ob.call_id}}" class="call-card on-time-state">
						<div class="call-card-top">
							<div class="card-support">
								<span>42</span>
								<img src="static/img/like.png" />
							</div>
							<div class="card-comment">
								<span>12</span>
								<img src="static/img/bubble.png" />					
							</div>

							<div class="card-category">{{ ob.category|e }}</div>
							<div class="card-street">{{ ob.street_name }}</div>
						</div>

						{% if ob.state=="aberto" %}
							<div class="call-card-bottom state-open">
						{% elif ob.state=="fechado" %}
							<div class="call-card-bottom state-closed">
						{% elif ob.state=="atrasado" %}
							<div class="call-card-bottom state-delayed">
						{% else %}
							<div class="call-card-bottom">
						{% endif %}
							<p>{{ob.state}}</p>
						</div>
					</div>
				</div><!-- col3 -->

				{% if loop.index0%4==3 %}
						</div>
					</div><!-- row -->
				{% endif %}

			{% endfor %}

		</div>
	
	</div>

	<div id="mapTeste">
		
	</div>

</body>
</html>
